{"version":3,"sources":["services/firebase.js","constants/paths.js","hooks/use-user.js","components/header.js","pages/not-found.js"],"names":["async","doesUsernameExist","username","firebase","firestore","collection","where","toLowerCase","get","docs","length","getUserByUsername","map","item","data","docId","id","getUserByUserId","userId","getSuggestedProfiles","following","query","limit","user","updateLoggedInUserFollowing","loggedInUserDocId","profileId","isFollowingProfile","doc","update","FieldValue","arrayRemove","arrayUnion","updateFollowedUserFollowers","profileDocId","followers","getPhotos","userFollowedPhotos","photo","Promise","all","userLikedPhoto","likes","includes","getUserPhotosByUserId","isUserFollowingProfile","loggedInUserUsername","profileUserId","result","response","toggleFollow","activeUserDocId","followingUserId","DEFAULT_IMAGE_PATH","useUser","activeUser","setActiveUser","useState","useEffect","getUserObjByUserId","Header","loggedInUser","useContext","UserContext","uid","FirebaseContext","history","useHistory","_jsx","className","children","_jsxs","Link","to","ROUTES","src","alt","_Fragment","xmlns","fill","viewBox","stroke","strokeLinecap","strokeLinejoin","strokeWidth","d","type","title","onClick","auth","signOut","push","onKeyDown","event","key","concat","onError","e","target","NotFound","document"],"mappings":"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","file":"static/js/7.c6b71588.chunk.js","sourcesContent":["import { firebase, FieldValue } from '../lib/firebase';\r\n\r\nexport async function doesUsernameExist(username) {\r\n  const result = await firebase\r\n    .firestore()\r\n    .collection('users')\r\n    .where('username', '==', username.toLowerCase())\r\n    .get();\r\n\r\n  return result.docs.length > 0;\r\n}\r\n\r\nexport async function getUserByUsername(username) {\r\n  const result = await firebase\r\n    .firestore()\r\n    .collection('users')\r\n    .where('username', '==', username.toLowerCase())\r\n    .get();\r\n\r\n  return result.docs.map((item) => ({\r\n    ...item.data(),\r\n    docId: item.id\r\n  }));\r\n}\r\n\r\n// get user from the firestore where userId === userId (passed from the auth)\r\nexport async function getUserByUserId(userId) {\r\n  const result = await firebase.firestore().collection('users').where('userId', '==', userId).get();\r\n  const user = result.docs.map((item) => ({\r\n    ...item.data(),\r\n    docId: item.id\r\n  }));\r\n\r\n  return user;\r\n}\r\n\r\n// check all conditions before limit results\r\nexport async function getSuggestedProfiles(userId, following) {\r\n  let query = firebase.firestore().collection('users');\r\n\r\n  if (following.length > 0) {\r\n    query = query.where('userId', 'not-in', [...following, userId]);\r\n  } else {\r\n    query = query.where('userId', '!=', userId);\r\n  }\r\n  const result = await query.limit(10).get();\r\n\r\n  const profiles = result.docs.map((user) => ({\r\n    ...user.data(),\r\n    docId: user.id\r\n  }));\r\n\r\n  return profiles;\r\n}\r\n\r\nexport async function updateLoggedInUserFollowing(\r\n  loggedInUserDocId, // currently logged in user document id (karl's profile)\r\n  profileId, // the user that karl requests to follow\r\n  isFollowingProfile // true/false (am i currently following this person?)\r\n) {\r\n  return firebase\r\n    .firestore()\r\n    .collection('users')\r\n    .doc(loggedInUserDocId)\r\n    .update({\r\n      following: isFollowingProfile ?\r\n        FieldValue.arrayRemove(profileId) :\r\n        FieldValue.arrayUnion(profileId)\r\n    });\r\n}\r\n\r\nexport async function updateFollowedUserFollowers(\r\n  profileDocId, // currently logged in user document id (karl's profile)\r\n  loggedInUserDocId, // the user that karl requests to follow\r\n  isFollowingProfile // true/false (am i currently following this person?)\r\n) {\r\n  return firebase\r\n    .firestore()\r\n    .collection('users')\r\n    .doc(profileDocId)\r\n    .update({\r\n      followers: isFollowingProfile ?\r\n        FieldValue.arrayRemove(loggedInUserDocId) :\r\n        FieldValue.arrayUnion(loggedInUserDocId)\r\n    });\r\n}\r\n\r\nexport async function getPhotos(userId, following) {\r\n  // [5,4,2] => following\r\n  const result = await firebase\r\n    .firestore()\r\n    .collection('photos')\r\n    .where('userId', 'in', following)\r\n    .get();\r\n\r\n  const userFollowedPhotos = result.docs.map((photo) => ({\r\n    ...photo.data(),\r\n    docId: photo.id\r\n  }));\r\n\r\n  const photosWithUserDetails = await Promise.all(\r\n    userFollowedPhotos.map(async (photo) => {\r\n      let userLikedPhoto = false;\r\n      if (photo.likes.includes(userId)) {\r\n        userLikedPhoto = true;\r\n      }\r\n      // photo.userId = 2\r\n      const user = await getUserByUserId(photo.userId);\r\n      // raphael\r\n      const { username } = user[0];\r\n      return { username, ...photo, userLikedPhoto };\r\n    })\r\n  );\r\n\r\n  return photosWithUserDetails;\r\n}\r\n\r\nexport async function getUserPhotosByUserId(userId) {\r\n  const result = await firebase\r\n    .firestore()\r\n    .collection('photos')\r\n    .where('userId', '==', userId)\r\n    .get();\r\n\r\n  const photos = result.docs.map((photo) => ({\r\n    ...photo.data(),\r\n    docId: photo.id\r\n  }));\r\n  return photos;\r\n}\r\n\r\nexport async function isUserFollowingProfile(loggedInUserUsername, profileUserId) {\r\n  const result = await firebase\r\n    .firestore()\r\n    .collection('users')\r\n    .where('username', '==', loggedInUserUsername) // karl (active logged in user)\r\n    .where('following', 'array-contains', profileUserId)\r\n    .get();\r\n\r\n  const [response = {}] = result.docs.map((item) => ({\r\n    ...item.data(),\r\n    docId: item.id\r\n  }));\r\n\r\n  return response.userId;\r\n}\r\n\r\nexport async function toggleFollow(\r\n  isFollowingProfile,\r\n  activeUserDocId,\r\n  profileDocId,\r\n  profileUserId,\r\n  followingUserId\r\n) {\r\n  // 1st param: karl's doc id\r\n  // 2nd param: raphael's user id\r\n  // 3rd param: is the user following this profile? e.g. does karl follow raphael? (true/false)\r\n  await updateLoggedInUserFollowing(activeUserDocId, profileUserId, isFollowingProfile);\r\n\r\n  // 1st param: karl's user id\r\n  // 2nd param: raphael's doc id\r\n  // 3rd param: is the user following this profile? e.g. does karl follow raphael? (true/false)\r\n  await updateFollowedUserFollowers(profileDocId, followingUserId, isFollowingProfile);\r\n}\r\n","export const DEFAULT_IMAGE_PATH = './images/avatars/default.png';\r\n","import { useState, useEffect } from 'react';\r\nimport { getUserByUserId } from '../services/firebase';\r\n\r\nexport default function useUser(userId) {\r\n  const [activeUser, setActiveUser] = useState();\r\n\r\n  useEffect(() => {\r\n    async function getUserObjByUserId(userId) {\r\n      const [user] = await getUserByUserId(userId);\r\n      setActiveUser(user || {});\r\n    }\r\n\r\n    if (userId) {\r\n      getUserObjByUserId(userId);\r\n    }\r\n  }, [userId]);\r\n\r\n  return { user: activeUser, setActiveUser };\r\n}\r\n","import { useContext } from 'react';\r\nimport { Link, useHistory } from 'react-router-dom';\r\nimport FirebaseContext from '../context/firebase';\r\nimport UserContext from '../context/user';\r\nimport * as ROUTES from '../constants/routes';\r\nimport { DEFAULT_IMAGE_PATH } from '../constants/paths';\r\nimport useUser from '../hooks/use-user';\r\n\r\nexport default function Header() {\r\n  const { user: loggedInUser } = useContext(UserContext);\r\n  const { user } = useUser(loggedInUser?.uid);\r\n  const { firebase } = useContext(FirebaseContext);\r\n  const history = useHistory();\r\n\r\n  return (\r\n    <header className=\"h-16 bg-white border-b border-gray-primary mb-8\">\r\n      <div className=\"container mx-auto max-w-screen-lg h-full\">\r\n        <div className=\"flex justify-between h-full\">\r\n          <div className=\"text-gray-700 text-center flex items-center align-items cursor-pointer\">\r\n            <h1 className=\"flex justify-center w-full\">\r\n              <Link to={ROUTES.DASHBOARD} aria-label=\"Instagram logo\">\r\n                <img src=\"./images/logo.png\" alt=\"Instagram\" className=\"mt-2 w-6/12\" />\r\n              </Link>\r\n            </h1>\r\n          </div>\r\n          <div className=\"text-gray-700 text-center flex items-center align-items\">\r\n            {loggedInUser ? (\r\n              <>\r\n                <Link to={ROUTES.DASHBOARD} aria-label=\"Dashboard\">\r\n                  <svg\r\n                    className=\"w-8 mr-6 text-black-light cursor-pointer\"\r\n                    xmlns=\"http://www.w3.org/2000/svg\"\r\n                    fill=\"none\"\r\n                    viewBox=\"0 0 24 24\"\r\n                    stroke=\"currentColor\"\r\n                  >\r\n                    <path\r\n                      strokeLinecap=\"round\"\r\n                      strokeLinejoin=\"round\"\r\n                      strokeWidth={2}\r\n                      d=\"M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6\"\r\n                    />\r\n                  </svg>\r\n                </Link>\r\n\r\n                <button\r\n                  type=\"button\"\r\n                  title=\"Sign Out\"\r\n                  onClick={() => {\r\n                    firebase.auth().signOut();\r\n                    history.push(ROUTES.LOGIN);\r\n                  }}\r\n                  onKeyDown={(event) => {\r\n                    if (event.key === 'Enter') {\r\n                      firebase.auth().signOut();\r\n                      history.push(ROUTES.LOGIN);\r\n                    }\r\n                  }}\r\n                >\r\n                  <svg\r\n                    className=\"w-8 mr-6 text-black-light cursor-pointer\"\r\n                    xmlns=\"http://www.w3.org/2000/svg\"\r\n                    fill=\"none\"\r\n                    viewBox=\"0 0 24 24\"\r\n                    stroke=\"currentColor\"\r\n                  >\r\n                    <path\r\n                      strokeLinecap=\"round\"\r\n                      strokeLinejoin=\"round\"\r\n                      strokeWidth={2}\r\n                      d=\"M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1\"\r\n                    />\r\n                  </svg>\r\n                </button>\r\n                {user && (\r\n                  <div className=\"flex items-center cursor-pointer\">\r\n                    <Link to={`/p/${user?.username}`}>\r\n                      <img\r\n                        className=\"rounded-full h-8 w-8 flex\"\r\n                        src={`./images/avatars/${user?.username}.jpg`}\r\n                        alt={`${user?.username} profile`}\r\n                        onError={(e) => {\r\n                          e.target.src = DEFAULT_IMAGE_PATH;\r\n                        }}\r\n                      />\r\n                    </Link>\r\n                  </div>\r\n                )}\r\n              </>\r\n            ) : (\r\n              <>\r\n                <Link to={ROUTES.LOGIN}>\r\n                  <button\r\n                    type=\"button\"\r\n                    className=\"bg-blue-medium font-bold text-sm rounded text-white w-20 h-8\"\r\n                  >\r\n                    Log In\r\n                  </button>\r\n                </Link>\r\n                <Link to={ROUTES.SIGN_UP}>\r\n                  <button\r\n                    type=\"button\"\r\n                    className=\"font-bold text-sm rounded text-blue-medium w-20 h-8\"\r\n                  >\r\n                    Sign Up\r\n                  </button>\r\n                </Link>\r\n              </>\r\n            )}\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </header>\r\n  );\r\n}\r\n","import { useEffect } from 'react';\r\nimport Header from '../components/header';\r\n\r\nexport default function NotFound() {\r\n  useEffect(() => {\r\n    document.title = 'Not Found - Instagram';\r\n  }, []);\r\n\r\n  return (\r\n    <div className=\"bg-gray-background\">\r\n      <Header />\r\n      <div className=\"mx-auto max-w-screen-lg\">\r\n        <p className=\"text-center text-2xl\">Not Found!</p>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"sourceRoot":""}