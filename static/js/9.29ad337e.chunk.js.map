{"version":3,"sources":["services/firebase.js","pages/sign-up.js"],"names":["async","doesUsernameExist","username","firebase","firestore","collection","where","toLowerCase","get","docs","length","getUserByUsername","map","item","data","docId","id","getUserByUserId","userId","getSuggestedProfiles","following","query","limit","user","updateLoggedInUserFollowing","loggedInUserDocId","profileId","isFollowingProfile","doc","update","FieldValue","arrayRemove","arrayUnion","updateFollowedUserFollowers","profileDocId","followers","getPhotos","userFollowedPhotos","photo","Promise","all","userLikedPhoto","likes","includes","getUserPhotosByUserId","isUserFollowingProfile","loggedInUserUsername","profileUserId","result","response","toggleFollow","activeUserDocId","followingUserId","SignUp","history","useHistory","useContext","FirebaseContext","setUsername","useState","fullName","setFullName","emailAddress","setEmailAddress","password","setPassword","error","setError","isInvalid","useEffect","document","title","_jsxs","className","children","_jsx","src","alt","onSubmit","event","preventDefault","createdUserResult","auth","createUserWithEmailAndPassword","updateProfile","displayName","add","uid","dateCreated","Date","now","push","ROUTES","message","method","type","placeholder","onChange","_ref","target","value","_ref2","_ref3","_ref4","disabled","concat","Link","to"],"mappings":"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","file":"static/js/9.29ad337e.chunk.js","sourcesContent":["import { firebase, FieldValue } from '../lib/firebase';\r\n\r\nexport async function doesUsernameExist(username) {\r\n  const result = await firebase\r\n    .firestore()\r\n    .collection('users')\r\n    .where('username', '==', username.toLowerCase())\r\n    .get();\r\n\r\n  return result.docs.length > 0;\r\n}\r\n\r\nexport async function getUserByUsername(username) {\r\n  const result = await firebase\r\n    .firestore()\r\n    .collection('users')\r\n    .where('username', '==', username.toLowerCase())\r\n    .get();\r\n\r\n  return result.docs.map((item) => ({\r\n    ...item.data(),\r\n    docId: item.id\r\n  }));\r\n}\r\n\r\n// get user from the firestore where userId === userId (passed from the auth)\r\nexport async function getUserByUserId(userId) {\r\n  const result = await firebase.firestore().collection('users').where('userId', '==', userId).get();\r\n  const user = result.docs.map((item) => ({\r\n    ...item.data(),\r\n    docId: item.id\r\n  }));\r\n\r\n  return user;\r\n}\r\n\r\n// check all conditions before limit results\r\nexport async function getSuggestedProfiles(userId, following) {\r\n  let query = firebase.firestore().collection('users');\r\n\r\n  if (following.length > 0) {\r\n    query = query.where('userId', 'not-in', [...following, userId]);\r\n  } else {\r\n    query = query.where('userId', '!=', userId);\r\n  }\r\n  const result = await query.limit(10).get();\r\n\r\n  const profiles = result.docs.map((user) => ({\r\n    ...user.data(),\r\n    docId: user.id\r\n  }));\r\n\r\n  return profiles;\r\n}\r\n\r\nexport async function updateLoggedInUserFollowing(\r\n  loggedInUserDocId, // currently logged in user document id (karl's profile)\r\n  profileId, // the user that karl requests to follow\r\n  isFollowingProfile // true/false (am i currently following this person?)\r\n) {\r\n  return firebase\r\n    .firestore()\r\n    .collection('users')\r\n    .doc(loggedInUserDocId)\r\n    .update({\r\n      following: isFollowingProfile ?\r\n        FieldValue.arrayRemove(profileId) :\r\n        FieldValue.arrayUnion(profileId)\r\n    });\r\n}\r\n\r\nexport async function updateFollowedUserFollowers(\r\n  profileDocId, // currently logged in user document id (karl's profile)\r\n  loggedInUserDocId, // the user that karl requests to follow\r\n  isFollowingProfile // true/false (am i currently following this person?)\r\n) {\r\n  return firebase\r\n    .firestore()\r\n    .collection('users')\r\n    .doc(profileDocId)\r\n    .update({\r\n      followers: isFollowingProfile ?\r\n        FieldValue.arrayRemove(loggedInUserDocId) :\r\n        FieldValue.arrayUnion(loggedInUserDocId)\r\n    });\r\n}\r\n\r\nexport async function getPhotos(userId, following) {\r\n  // [5,4,2] => following\r\n  const result = await firebase\r\n    .firestore()\r\n    .collection('photos')\r\n    .where('userId', 'in', following)\r\n    .get();\r\n\r\n  const userFollowedPhotos = result.docs.map((photo) => ({\r\n    ...photo.data(),\r\n    docId: photo.id\r\n  }));\r\n\r\n  const photosWithUserDetails = await Promise.all(\r\n    userFollowedPhotos.map(async (photo) => {\r\n      let userLikedPhoto = false;\r\n      if (photo.likes.includes(userId)) {\r\n        userLikedPhoto = true;\r\n      }\r\n      // photo.userId = 2\r\n      const user = await getUserByUserId(photo.userId);\r\n      // raphael\r\n      const { username } = user[0];\r\n      return { username, ...photo, userLikedPhoto };\r\n    })\r\n  );\r\n\r\n  return photosWithUserDetails;\r\n}\r\n\r\nexport async function getUserPhotosByUserId(userId) {\r\n  const result = await firebase\r\n    .firestore()\r\n    .collection('photos')\r\n    .where('userId', '==', userId)\r\n    .get();\r\n\r\n  const photos = result.docs.map((photo) => ({\r\n    ...photo.data(),\r\n    docId: photo.id\r\n  }));\r\n  return photos;\r\n}\r\n\r\nexport async function isUserFollowingProfile(loggedInUserUsername, profileUserId) {\r\n  const result = await firebase\r\n    .firestore()\r\n    .collection('users')\r\n    .where('username', '==', loggedInUserUsername) // karl (active logged in user)\r\n    .where('following', 'array-contains', profileUserId)\r\n    .get();\r\n\r\n  const [response = {}] = result.docs.map((item) => ({\r\n    ...item.data(),\r\n    docId: item.id\r\n  }));\r\n\r\n  return response.userId;\r\n}\r\n\r\nexport async function toggleFollow(\r\n  isFollowingProfile,\r\n  activeUserDocId,\r\n  profileDocId,\r\n  profileUserId,\r\n  followingUserId\r\n) {\r\n  // 1st param: karl's doc id\r\n  // 2nd param: raphael's user id\r\n  // 3rd param: is the user following this profile? e.g. does karl follow raphael? (true/false)\r\n  await updateLoggedInUserFollowing(activeUserDocId, profileUserId, isFollowingProfile);\r\n\r\n  // 1st param: karl's user id\r\n  // 2nd param: raphael's doc id\r\n  // 3rd param: is the user following this profile? e.g. does karl follow raphael? (true/false)\r\n  await updateFollowedUserFollowers(profileDocId, followingUserId, isFollowingProfile);\r\n}\r\n","import { useState, useContext, useEffect } from 'react';\r\nimport { Link, useHistory } from 'react-router-dom';\r\nimport FirebaseContext from '../context/firebase';\r\nimport * as ROUTES from '../constants/routes';\r\nimport { doesUsernameExist } from '../services/firebase';\r\n\r\nexport default function SignUp() {\r\n  const history = useHistory();\r\n  const { firebase } = useContext(FirebaseContext);\r\n\r\n  const [username, setUsername] = useState('');\r\n  const [fullName, setFullName] = useState('');\r\n  const [emailAddress, setEmailAddress] = useState('');\r\n  const [password, setPassword] = useState('');\r\n\r\n  const [error, setError] = useState('');\r\n  const isInvalid = password === '' || emailAddress === '';\r\n\r\n  const handleSignUp = async (event) => {\r\n    event.preventDefault();\r\n\r\n    const usernameExists = await doesUsernameExist(username);\r\n    if (!usernameExists) {\r\n      try {\r\n        const createdUserResult = await firebase\r\n          .auth()\r\n          .createUserWithEmailAndPassword(emailAddress, password);\r\n\r\n        // authentication\r\n        // -> emailAddress & password & username (displayName)\r\n        await createdUserResult.user.updateProfile({\r\n          displayName: username\r\n        });\r\n\r\n        // firebase user collection (create a document)\r\n        await firebase\r\n          .firestore()\r\n          .collection('users')\r\n          .add({\r\n            userId: createdUserResult.user.uid,\r\n            username: username.toLowerCase(),\r\n            fullName,\r\n            emailAddress: emailAddress.toLowerCase(),\r\n            following: ['2'],\r\n            followers: [],\r\n            dateCreated: Date.now()\r\n          });\r\n\r\n        history.push(ROUTES.DASHBOARD);\r\n      } catch (error) {\r\n        setFullName('');\r\n        setEmailAddress('');\r\n        setPassword('');\r\n        setError(error.message);\r\n      }\r\n    } else {\r\n      setUsername('');\r\n      setError('That username is already taken, please try another.');\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    document.title = 'Sign Up - Instagram';\r\n  }, []);\r\n\r\n  return (\r\n    <div className=\"container flex mx-auto max-w-screen-md items-center h-screen\">\r\n      <div className=\"flex w-3/5\">\r\n        <img src=\"/images/iphone-with-profile.jpg\" alt=\"iPhone with Instagram app\" />\r\n      </div>\r\n      <div className=\"flex flex-col w-2/5\">\r\n        <div className=\"flex flex-col items-center bg-white p-4 border border-gray-primary mb-4 rounded\">\r\n          <h1 className=\"flex justify-center w-full\">\r\n            <img src=\"/images/logo.png\" alt=\"Instagram\" className=\"mt-2 w-6/12 mb-4\" />\r\n          </h1>\r\n\r\n          {error && <p className=\"mb-4 text-xs text-red-primary\">{error}</p>}\r\n\r\n          <form onSubmit={handleSignUp} method=\"POST\">\r\n            <input\r\n              aria-label=\"Enter your username\"\r\n              type=\"text\"\r\n              placeholder=\"Username\"\r\n              className=\"text-sm text-gray-base w-full mr-3 py-5 px-4 h-2 border border-gray-primary rounded mb-2\"\r\n              onChange={({ target }) => setUsername(target.value)}\r\n              value={username}\r\n            />\r\n            <input\r\n              aria-label=\"Enter your full name\"\r\n              type=\"text\"\r\n              placeholder=\"Full name\"\r\n              className=\"text-sm text-gray-base w-full mr-3 py-5 px-4 h-2 border border-gray-primary rounded mb-2\"\r\n              onChange={({ target }) => setFullName(target.value)}\r\n              value={fullName}\r\n            />\r\n            <input\r\n              aria-label=\"Enter your email address\"\r\n              type=\"text\"\r\n              placeholder=\"Email address\"\r\n              className=\"text-sm text-gray-base w-full mr-3 py-5 px-4 h-2 border border-gray-primary rounded mb-2\"\r\n              onChange={({ target }) => setEmailAddress(target.value)}\r\n              value={emailAddress}\r\n            />\r\n            <input\r\n              aria-label=\"Enter your password\"\r\n              type=\"password\"\r\n              placeholder=\"Password\"\r\n              className=\"text-sm text-gray-base w-full mr-3 py-5 px-4 h-2 border border-gray-primary rounded mb-2\"\r\n              onChange={({ target }) => setPassword(target.value)}\r\n              value={password}\r\n            />\r\n            <button\r\n              disabled={isInvalid}\r\n              type=\"submit\"\r\n              className={`bg-blue-medium text-white w-full rounded h-8 font-bold\r\n            ${isInvalid && 'opacity-50'}`}\r\n            >\r\n              Sign Up\r\n            </button>\r\n          </form>\r\n        </div>\r\n        <div className=\"flex justify-center items-center flex-col w-full bg-white p-4 rounded border border-gray-primary\">\r\n          <p className=\"text-sm\">\r\n            Have an account?{` `}\r\n            <Link to={ROUTES.LOGIN} className=\"font-bold text-blue-medium\">\r\n              Login\r\n            </Link>\r\n          </p>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"sourceRoot":""}